{"version":3,"file":"router-guard.js","sources":["utils/router-guard.js"],"sourcesContent":["import { useUserStore } from '../stores/user'\r\n\r\n\r\n// 路由拦截器\r\nexport function setupRouterGuard() {\r\n\t// console.log('开始初始化路由拦截器')\r\n\t\r\n\t// 拦截页面跳转\r\n\tuni.addInterceptor('navigateTo', {\r\n\t\tinvoke(e) {\r\n\t\t\t// console.log('拦截 navigateTo:', e.url)\r\n\t\t\treturn checkLogin(e.url)\r\n\t\t}\r\n\t})\r\n\t\r\n\tuni.addInterceptor('redirectTo', {\r\n\t\tinvoke(e) {\r\n\t\t\t// console.log('拦截 redirectTo:', e.url)\r\n\t\t\treturn checkLogin(e.url)\r\n\t\t}\r\n\t})\r\n\t\r\n\tuni.addInterceptor('reLaunch', {\r\n\t\tinvoke(e) {\r\n\t\t\t// console.log('拦截 reLaunch:', e.url)\r\n\t\t\treturn checkLogin(e.url)\r\n\t\t}\r\n\t})\r\n\t\r\n\tuni.addInterceptor('switchTab', {\r\n\t\tinvoke(e) {\r\n\t\t\t// console.log('拦截 switchTab:', e.url)\r\n\t\t\treturn checkLogin(e.url)\r\n\t\t}\r\n\t})\r\n\t\r\n\t\r\n\t// console.log('路由拦截器初始化完成')\r\n}\r\n\r\n// 检查登录状态\r\nfunction checkLogin(url) {\r\n\t// console.log('检查登录状态:', url)\r\n\tconst userStore = useUserStore()\r\n\t\r\n\t// 检查是否是登录相关页面\r\n\tif (url.includes('/pages/login/')) {\r\n\t\t// console.log('是登录页面，允许访问')\r\n\t\treturn true\r\n\t}\r\n\t\r\n\t// 如果不是登录页面且未登录，则跳转到登录页\r\n\tif (!userStore.isLoggedIn) {\r\n\t\t// console.log('未登录，跳转到登录页')\r\n\t\tuni.reLaunch({\r\n\t\t\turl: '/pages/login/index'\r\n\t\t})\r\n\t\treturn false\r\n\t}\r\n\t\r\n\t// console.log('已登录，允许访问')\r\n\treturn true\r\n}"],"names":["uni","useUserStore"],"mappings":";;;AAIO,SAAS,mBAAmB;AAIlCA,gBAAG,MAAC,eAAe,cAAc;AAAA,IAChC,OAAO,GAAG;AAET,aAAO,WAAW,EAAE,GAAG;AAAA,IACvB;AAAA,EACH,CAAE;AAEDA,gBAAG,MAAC,eAAe,cAAc;AAAA,IAChC,OAAO,GAAG;AAET,aAAO,WAAW,EAAE,GAAG;AAAA,IACvB;AAAA,EACH,CAAE;AAEDA,gBAAG,MAAC,eAAe,YAAY;AAAA,IAC9B,OAAO,GAAG;AAET,aAAO,WAAW,EAAE,GAAG;AAAA,IACvB;AAAA,EACH,CAAE;AAEDA,gBAAG,MAAC,eAAe,aAAa;AAAA,IAC/B,OAAO,GAAG;AAET,aAAO,WAAW,EAAE,GAAG;AAAA,IACvB;AAAA,EACH,CAAE;AAIF;AAGA,SAAS,WAAW,KAAK;AAExB,QAAM,YAAYC,YAAAA,aAAc;AAGhC,MAAI,IAAI,SAAS,eAAe,GAAG;AAElC,WAAO;AAAA,EACP;AAGD,MAAI,CAAC,UAAU,YAAY;AAE1BD,kBAAAA,MAAI,SAAS;AAAA,MACZ,KAAK;AAAA,IACR,CAAG;AACD,WAAO;AAAA,EACP;AAGD,SAAO;AACR;;"}